---
title: "Patient profiling tool"
subtitle: "R-Evolution TF Study Conduct Monitoring"
author: 
  name: "Laure Cougnaud (OpenAnalytics), Bjorn Daems, Paul Meyvisch"
  company: ""

date: "October 1st, 2018"
output:
  glpgStyle::ioslides:
    self_contained: true
---

```{r loadLibraries, echo = FALSE, message = FALSE}

	library(glpgStyle)
	library(knitr)
	opts_chunk$set(
			echo = FALSE, results = 'asis', warning = FALSE, 
			error = FALSE, message = FALSE, cache = FALSE,
			fig.width = 8, fig.height = 7,
			fig.path = "./figures_vignette/",
			fig.align = 'center')

```

## Goal

* Create **patient profile visualization** for specific trial:
    + main endpoint(s)
    + laboratory measurements
    + adverse events
    + treatment exposure ...

## General

Two setups:

* **Non-statisticians/medics**: 
    + user-friendly **graphical interface** for creation
  of patient profile report
* **Statisticians/programmers**: 
    + **functionalities** available via `R` package
    + creation of visualization outside of the report 
      
## Framework

* Create visualization of time profile for each set of metrics of
      interest:  
    e.g. main
        endpoint, laboratory parameters, adverse event, subject-specific
        metadata information
* Combine the different modules across time frame
* Create patient profile report
    
## Input data    
    
* Data format: SAS dataset (_.sas7bdat_)
* Data types:
    + `SDTM`: _Study Data Tabulation Model_
    + `ADaM`: _Analysis Data Model_
* Advantage: **standardized format**:
    + variable sensible name
    + default modules in the interface
    
## Concept of 'modules'

* Modular approach: 
    + 4 types of visualization: text, event, interval and line profile
    + creation of visualization/`module` for each set of metrics of interest

## Text module

* subject-specific descriptive information
    + Set of variables (e.g. demography)  
```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/exampleTextModule-wideFormat-include-1.png")
```
    + Pair of matched variable(s) (e.g. medical history)  
```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/exampleTestModule-longFormat-multipleVariables-include-1.png")
```

## Interval module

* metric with start/end time (e.g. adverse
      events)

```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/exampleModule_interval_AE.png")
```

* missing start/end date
    + open arrow representation
    + extra variable, e.g. first/last visit
  (`subject-visit` dataset)

## Event module

* metric with unique fixed time (e.g. laboratory measurements)

```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/exampleEventModuleWithSubset-include-1.png")
```

## Line module

* time evolution of numeric metric of parameters of interest in the
  time frame
(e.g. actual value, change from baseline  in the time
  frame of laboratory parameters)

```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/exampleLineModule-colorShape-include-1.png")
```

* option for dataset/variables specification for reference range


## Final deliverable

* Report (`pdf` format) with time profiles of interest per subject

```{r fig.align = "center", out.width = "70%"}    
include_graphics("./images/report1.png")
```

## Time settings

* Time
    + **consistent across modules** (datasets)
    + numeric format
    + relative day (_DY_)

## Interface

* Creation of the time profile visualization
    + directly from a web browser
    + user-friendly: default module settings available for `SDTM` format
        + name dataset/variable (implemented _Pelican_ study)
* Option for custom-defined visualization

```{r fig.align = "center", out.width = "80%"}    
include_graphics("./images/appMainPage.png")
```

## Interface: Preview panel

* Creation of user-custom visualization: preview panel

<div class="columns-2">
```{r fig.align = "center", out.width = "80%"}    
include_graphics("./images/module_interval_AE.png")
```

```{r fig.align = "center", out.width = "100%"}    
include_graphics("./images/previewModule_interval_AE.png")
```
</div>

## Interface: settings export

* Creation of user-custom visualization:
    + share settings with collaborators
    + facilitate graphics creation for new version of the datasets
    
```{r fig.align = "center", out.width = "35%"}    
include_graphics("./images/previewModule_save.png")
```

## Interface {.centered}

* Demonstration PoC

## Implementation details

* Open-source
  [<img src="./images/Rlogo.png" alt="R logo" height="32">](https://www.r-project.org/)
  software and add-on R packages: 
     + import of SAS dataset: `haven`, visualization: `ggplot2`
     + interface creation: `shiny`
* Tools:
    + for R expert: 
        + all functionalities
        + `patientProfilesVis` R package
    + for Medics: 
        + set of functionalities in web application
        + `patientProfilesVisShiny` R package
        + PoC deployed in a _Galapagos_ R Biometrics server

## Application details

* Technical details:
    + `Shiny` application embedded in the R package
    + Local or server deployment
    + Deployment with the [`ShinyProxy`](https://www.shinyproxy.io/) technology
         + `Docker` container encapsule all pre-requisite tools  
         $\rightarrow$ fixed version of `R` base and packages 
         + Scale up to large number of users 

## Reproducibility

* *ShinyProxy*: R/package(s) specific version in an isolated environment
* R package version in report

```{r fig.align = "center", out.width = "70%"}    
include_graphics("./images/report_sessionInfo.png")
```

## Conclusion

* User-friendly graphical interface for creation of patient-specific profile
  report
* Future work(s):
    + _Galapagos_ authentification system
    + Link to data storage: SAS _LSAF_ (Life Science Analytics Framework)
      dataset
* Questions?


